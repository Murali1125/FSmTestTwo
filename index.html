<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Fields</title>
    <link href="https://unpkg.com/fundamental-styles" rel="stylesheet">
    <link href='fundamental-styles.css' rel='stylesheet'>
    <link href="styles.css" rel="stylesheet">
  </head>
  <body>
    <div>

      <div class="mainContainer">
          <h1> <img src="./evoraLogo.png" alt="Evora" class="comapnyLogo"/></h1>
          <h2 class="fd-title fd-title--h2" id="info"> Evora it Solutions</h2>
      </div>
      <div>
        <input placeholder="user Name" class="fd-input c_input" type="text"  id="userName"/>
        <input placeholder="userId" class="fd-input c_input" type="number" id="userId"/>
        <button class="fd-button fd-button--compact c_btn" onclick="UpdateUser()">
          <span class="fd-button__text"> Popup </span>
        </button>
      </div>
    </div>
    <script src="https://unpkg.com/fsm-shell"></script>
    <script src="Handlers.js"></script>

    <script src="script.js"></script>
    <script>
      // Import ShellSDK and events list from FSMShell global variable
      // see https://github.com/SAP/fsm-shell for more details.
      const { ShellSdk, SHELL_EVENTS } = FSMShell;
        console.log(ShellSdk)
      // Display an error message if extension does not run within shell
      if (!ShellSdk.isInsideShell()) {
        console.log(ShellSdk)
        updateUI('Unable to reach shell eventAPI');
      } else {
        console.log(ShellSdk)
        // Initialise ShellSDK to connect with parent shell library
        const shellSdk = ShellSdk.init(parent, '*');

        // Initialise the extension by requesting the fsm context
        shellSdk.emit(SHELL_EVENTS.Version1.REQUIRE_CONTEXT, {
          clientIdentifier: 'service-contract',
          auth: {
            response_type: 'token'  // request a user token within the context
          }
        });

        // Callback on fsm context response
        shellSdk.on(SHELL_EVENTS.Version1.REQUIRE_CONTEXT, (event) => {

          const {
            // extract required context from event content
            cloudHost,
            account,
            company,
            user,
            // extract authentication data from event content
            auth
          } = JSON.parse(event);

          // Access_token has a short life stpan and needs to be refreshed before expiring
          // Each extension need to implement its own strategy to fresh it.
          initializeRefreshTokenStrategy(shellSdk, auth);

          // Add a listenner expecting activityID
          shellSdk.onViewState('activityID', async activityID => {

            updateUI(`Loading ...`);

            let serviceContract = await getServiceContract(cloudHost, account, company, activityID);

            updateUI(serviceContract ? `${serviceContract.contractType}` : `NO CONTRACT`);
          });
        });
      }
    </script>
  </body>
</html>